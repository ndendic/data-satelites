<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub CDN Plugin Loading Test</title>
  
  <!-- GitHub CDN Plugin Loading -->
  <script type="module">
    // Import Datastar from official CDN
    import { load, apply } from 'https://cdn.jsdelivr.net/gh/starfederation/datastar@1.0.0-RC.5/bundles/datastar.js';
    
    // Make it available globally
    window.datastar = { load, apply };
    
    // Initialize Datastar
    apply();
    
    // Load plugin system from GitHub CDN
    await import('https://cdn.jsdelivr.net/gh/ndendic/data-satelites@master/dist/plugin-loader-browser.js');
    
    // Configure to load plugins from GitHub CDN
    window.DatastarPluginLoader.setBaseURL('https://cdn.jsdelivr.net/gh/ndendic/data-satelites@master/dist/');
    
    // Auto-load plugins
    await datastar.autoLoadPlugins();
  </script>
  
  <style>
    body { 
      font-family: system-ui; 
      padding: 20px; 
      background: #f5f5f5; 
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      background: white; 
      padding: 30px; 
      border-radius: 8px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .status {
      padding: 8px 12px;
      border-radius: 4px;
      margin: 8px 0;
      font-weight: 500;
    }
    
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    
    .log {
      background: #f8f9fa;
      border-left: 4px solid #dee2e6;
      padding: 8px 12px;
      margin: 4px 0;
      font-family: monospace;
      font-size: 12px;
    }
    
    .log.info { border-color: #0dcaf0; }
    .log.success { border-color: #198754; }
    .log.error { border-color: #dc3545; }
    .log.warning { border-color: #fd7e14; }
    
    button {
      background: #0d6efd;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 4px;
    }
    
    button:hover { background: #0b5ed7; }
    
    .tooltip {
      background: #333;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1000;
      display: none;
    }
    
    .demo-section {
      margin: 20px 0;
      padding: 20px;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåê GitHub CDN Plugin Loading Test</h1>
    <p>Testing Datastar anchor plugin loaded directly from GitHub CDN.</p>
    
    <div id="log-container">
      <!-- Logs will appear here -->
    </div>
    
    <div class="demo-section">
      <h2>üîß System Status</h2>
      <div>
        <div id="datastar-status" class="status">‚ùì Checking Datastar...</div>
        <div id="loader-status" class="status">‚ùì Checking Plugin Loader...</div>
        <div id="cdn-status" class="status">‚ùì Checking GitHub CDN...</div>
      </div>
    </div>
    
    <div class="demo-section">
      <h2>üöÄ Plugin Loading Tests</h2>
      <button onclick="testPluginLoading()">Test Plugin Loading</button>
      <button onclick="showLoadedPlugins()">Show Loaded Plugins</button>
      <div id="plugin-results">Plugin test results will appear here...</div>
    </div>
    
    <div class="demo-section">
      <h2>‚ö° Anchor Plugin Demo - GitHub CDN</h2>
      <p>Testing anchor plugin loaded from: <code>https://cdn.jsdelivr.net/gh/ndendic/data-satelites@master/</code></p>
      
      <button id="demo-button" onclick="toggleTooltip()">Demo Button</button>
      
      <div id="tooltip" class="tooltip" data-anchor-top="'#demo-button'">
        üéâ Tooltip loaded from GitHub CDN!
      </div>
    </div>
    
    <div class="demo-section">
      <h2>üìä Debug Information</h2>
      <div id="debug-info">Debug information will appear here...</div>
    </div>
  </div>

  <script>
    let logContainer = document.getElementById('log-container');
    let debugInfo = document.getElementById('debug-info');
    
    function log(message, level = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = `log ${level}`;
      logEntry.textContent = `[${timestamp}] ${message}`;
      logContainer.appendChild(logEntry);
      console.log(`[${timestamp}] ${message}`);
    }
    
    function updateDebug(message) {
      debugInfo.innerHTML += message + '<br>';
    }
    
    function toggleTooltip() {
      try {
        const tooltip = document.getElementById('tooltip');
        const isVisible = tooltip.style.display !== 'none';
        tooltip.style.display = isVisible ? 'none' : 'block';
        log(`Tooltip ${isVisible ? 'hidden' : 'shown'}`, 'success');
      } catch (error) {
        log(`Tooltip toggle failed: ${error.message}`, 'error');
      }
    }
    
    function testPluginLoading() {
      try {
        if (window.datastar && window.datastar.getLoadedPlugins) {
          const plugins = window.datastar.getLoadedPlugins();
          document.getElementById('plugin-results').innerHTML = 
            `Loaded plugins: ${plugins.map(p => p.name).join(', ') || 'None'}`;
          log(`Found ${plugins.length} loaded plugins`, 'success');
        } else {
          document.getElementById('plugin-results').innerHTML = 'Plugin loading methods not available';
          log('Plugin loading methods not available', 'warning');
        }
      } catch (error) {
        document.getElementById('plugin-results').innerHTML = `Error: ${error.message}`;
        log(`Plugin test failed: ${error.message}`, 'error');
      }
    }
    
    function showLoadedPlugins() {
      testPluginLoading();
    }
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      log('DOM Content Loaded', 'info');
      
      // Check Datastar (should be loaded by now from CDN)
      setTimeout(() => {
        if (window.datastar) {
          document.getElementById('datastar-status').textContent = '‚úÖ Datastar Ready (Official CDN)';
          document.getElementById('datastar-status').className = 'status success';
          log('Datastar detected from official CDN', 'success');
          updateDebug('Datastar object: ' + typeof window.datastar);
          updateDebug('Datastar methods: ' + Object.keys(window.datastar).join(', '));
        } else {
          document.getElementById('datastar-status').textContent = '‚ùå Datastar Missing';
          document.getElementById('datastar-status').className = 'status error';
          log('Datastar not found', 'error');
        }

        // Check Plugin Loader
        if (window.DatastarPluginLoader) {
          document.getElementById('loader-status').textContent = '‚úÖ Plugin Loader Ready (GitHub CDN)';
          document.getElementById('loader-status').className = 'status success';
          log('Plugin Loader detected from GitHub CDN', 'success');
          updateDebug('Plugin Loader available from GitHub');
          updateDebug('Base URL: ' + window.DatastarPluginLoader.getBaseURL());
        } else {
          document.getElementById('loader-status').textContent = '‚ùå Plugin Loader Missing';
          document.getElementById('loader-status').className = 'status error';
          log('Plugin Loader not found', 'error');
        }
        
        // Check GitHub CDN status
        setTimeout(() => {
          if (window.DatastarPluginLoader && window.DatastarPluginLoader.getBaseURL().includes('github')) {
            document.getElementById('cdn-status').textContent = '‚úÖ GitHub CDN Active';
            document.getElementById('cdn-status').className = 'status success';
            log('GitHub CDN configuration detected', 'success');
            updateDebug('CDN URL: ' + window.DatastarPluginLoader.getBaseURL());
          } else {
            document.getElementById('cdn-status').textContent = '‚ùå GitHub CDN Not Configured';
            document.getElementById('cdn-status').className = 'status error';
            log('GitHub CDN not configured', 'warning');
          }
          
          // Check if auto-loading worked
          if (window.datastar && window.datastar.getLoadedPlugins) {
            const loaded = window.datastar.getLoadedPlugins();
            if (loaded.length > 0) {
              log(`GitHub CDN auto-loading successful! ${loaded.length} plugins loaded`, 'success');
              updateDebug('Auto-loaded from GitHub: ' + loaded.map(p => `${p.name}@${p.version || 'latest'}`).join(', '));
            } else {
              log('Auto-loading completed but no plugins found from GitHub CDN', 'info');
            }
          }
        }, 2000);
        
      }, 1000);
    });
  </script>
</body>
</html>