<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datastar Anchor Plugin - Integration Test</title>

    <script type="module">
        import { load, apply } from 'https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js';
        import AnchorPlugin from './dist/src/anchor.js';

        console.log('Datastar Anchor Demo: Loading plugin...', AnchorPlugin);
        
        // Enable more detailed logging
        window.localStorage.setItem('debug', 'datastar*');
        
        load(AnchorPlugin);
        console.log('Datastar Anchor Demo: Plugin loaded, applying...');
        apply();
        console.log('Datastar Anchor Demo: Datastar applied');
    </script>

    <style>
        /* Basic styling for anchor demo */
        .anchor-target {
            width: 100px;
            height: 40px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }

        .anchored-element {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            width: 150px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .anchor-container {
            position: relative;
            height: 300px;
            border: 2px dashed #ccc;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        .scrollable-content {
            width: 800px;
            height: 600px;
            background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .scroll-instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            max-width: 200px;
        }
    </style>
</head>
<body style="padding: 20px; font-family: Arial, sans-serif;">
    <h2>Datastar Anchor Plugin Demo</h2>

    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h3>ðŸŽ¯ Advanced Scrolling Test</h3>
        <p>This demo tests both internal scrolling (within the container) and page scrolling. The tooltips should maintain their position relative to the anchor button in both scenarios.</p>
    </div>

        <div class="anchor-container" data-signals="{isVisible: false, edgeTest: false}">
        <div class="scrollable-content">
            <div class="scroll-instructions">
                <strong>ðŸ“œ Scroll around</strong><br>
                Hover over the button and scroll to see tooltips follow the anchor!
            </div>
            <button id="target-button" class="anchor-target" data-on-click="$isVisible = !$isVisible" style="width: 300px; height: 100px;">
                Anchor Target
            </button>
        </div>
    </div>

    <!-- Element anchored using new value-based syntax -->
    <div data-anchor="'#target-button, left, 20px'" data-show="$isVisible" class="anchored-element" style="display: none; background: #dc3545;">
        Left + 20px
    </div>

    <div data-anchor="'#target-button, right-start, 100px'" data-show="$isVisible" class="anchored-element" style="display: none; background: #28a745;">
        Right Start + 100px
    </div>

    <div data-anchor="'#target-button, bottom-end, 2rem'" data-show="$isVisible" class="anchored-element" style="display: none; background: #fd7e14;">
        Bottom End + 2rem
    </div>

    <div data-anchor="'#target-button, top-start, 50'" data-show="$isVisible" class="anchored-element" style="display: none; background: #6f42c1;">
        Top Start + 50px (no unit)
    </div>

            <div data-anchor="'#target-button, right, 5vh'" data-show="$isVisible" class="anchored-element" style="display: none; background: #17a2b8;">
                Right + 5vh
            </div>

            <!-- Test viewport edge flipping -->
            <button id="edge-test-button" style="position: fixed; top: 10px; right: 10px; background: #e91e63; color: white; padding: 10px; border: none; border-radius: 4px;" data-on-click="$edgeTest = !$edgeTest">
                Edge Test (Top-Right)
            </button>
            
            <div data-anchor="'#edge-test-button, right, 20px'" data-show="$edgeTest" class="anchored-element" style="display: none; background: #e91e63; color: white;">
                Should flip to left!
            </div>
            
            <div data-anchor="'#edge-test-button, top, 20px'" data-show="$edgeTest" class="anchored-element" style="display: none; background: #9c27b0; color: white;">
                Should flip to bottom!
            </div>

    <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
        <strong>New Value-Based Syntax:</strong><br>
        <code>data-anchor="'#selector, placement, offset'"</code><br><br>
        
        <strong>Examples:</strong><br>
        â€¢ <code>data-anchor="'#target, top, 20px'"</code> - Top with 20px offset<br>
        â€¢ <code>data-anchor="'#target, right-start, 2rem'"</code> - Right-start with 2rem offset<br>
        â€¢ <code>data-anchor="'#target, bottom'"</code> - Bottom with default offset<br>
        â€¢ <code>data-anchor="'#target'"</code> - Default placement (bottom) and offset<br><br>
        
        <strong>Supported units:</strong> px, rem, em, %, vw, vh<br>
        <strong>Test:</strong> Scroll and resize to see responsive positioning!
    </div>

    <!-- Add some content to enable page scrolling -->
    <div style="margin-top: 50px; padding: 30px; background: #f8f9fa; border-radius: 8px;">
        <h3>ðŸ”„ Page Scrolling Test</h3>
        <p>Scroll down the page while hovering over the anchor button to test how tooltips handle page-level scrolling.</p>
        <div style="height: 200px; background: linear-gradient(to bottom, #ffffff, #f0f0f0); margin: 20px 0; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666;">
            Extra content for scrolling
        </div>
        <div style="height: 200px; background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); margin: 20px 0; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666;">
            More content for testing
        </div>
        <div style="height: 200px; background: linear-gradient(to bottom, #e0e0e0, #d0d0d0); margin: 20px 0; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666;">
            Scroll back up to the anchor!
        </div>
    </div>
</body>
</html>