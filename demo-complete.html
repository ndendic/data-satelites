<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datastar Anchor Plugin - Complete Integration Test</title>
    <style>
        :root {
            --primary-blue: #3498db;
            --primary-dark: #2c3e50;
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
            --light-gray: #ecf0f1;
            --medium-gray: #bdc3c7;
            --dark-gray: #7f8c8d;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin: 0 0 10px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin: 0;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .test-card h3 {
            color: var(--primary-dark);
            margin: 0 0 16px 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-card p {
            color: var(--dark-gray);
            margin: 0 0 20px 0;
            font-size: 0.95rem;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: var(--warning-orange);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: var(--danger-red);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Tooltip Styles */
        .tooltip {
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            max-width: 200px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
        }

        .tooltip.success {
            background: rgba(39, 174, 96, 0.95);
        }

        .tooltip.warning {
            background: rgba(243, 156, 18, 0.95);
        }

        .tooltip.danger {
            background: rgba(231, 76, 60, 0.95);
        }

        /* Popover Styles */
        .popover {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--medium-gray);
            max-width: 280px;
            z-index: 1000;
            display: none;
        }

        .popover-header {
            font-weight: 600;
            color: var(--primary-dark);
            margin: 0 0 8px 0;
            font-size: 15px;
        }

        .popover-body {
            color: var(--dark-gray);
            font-size: 14px;
            line-height: 1.4;
            margin: 0;
        }

        /* Dropdown Menu */
        .dropdown-menu {
            background: white;
            border-radius: 8px;
            padding: 6px 0;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--medium-gray);
            min-width: 160px;
            z-index: 1000;
            display: none;
        }

        .dropdown-item {
            padding: 8px 16px;
            color: var(--primary-dark);
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dropdown-item:hover {
            background: var(--light-gray);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--medium-gray);
            margin: 4px 0;
        }

        /* Edge Testing Area */
        .edge-container {
            position: relative;
            height: 300px;
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .edge-button {
            position: absolute;
        }

        .edge-button.top-left { top: 15px; left: 15px; }
        .edge-button.top-right { top: 15px; right: 15px; }
        .edge-button.bottom-left { bottom: 15px; left: 15px; }
        .edge-button.bottom-right { bottom: 15px; right: 15px; }
        .edge-button.center { top: 50%; left: 50%; transform: translate(-50%, -50%); }

        .edge-info {
            text-align: center;
            color: var(--dark-gray);
            font-size: 14px;
        }

        /* Status and Info */
        .status-bar {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        .status-bar.success {
            background: rgba(39, 174, 96, 0.1);
            border-color: var(--success-green);
            color: #1e7e34;
        }

        .status-bar.error {
            background: rgba(231, 76, 60, 0.1);
            border-color: var(--danger-red);
            color: #721c24;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-blue);
        }

        .feature-item h4 {
            margin: 0 0 4px 0;
            color: white;
            font-size: 14px;
        }

        .feature-item p {
            margin: 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
        }

        /* Code Examples */
        .code-example {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
            border-left: 4px solid var(--primary-blue);
        }

        .code-example .comment {
            color: #95a5a6;
            font-style: italic;
        }

        .code-example .attribute {
            color: #3498db;
        }

        .code-example .string {
            color: #e74c3c;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Datastar Anchor Plugin</h1>
            <p>Complete integration test suite with viewport-aware positioning</p>
        </div>

        <div class="status-bar success" id="status">
            ✅ Plugin loaded successfully - Ready for comprehensive testing
        </div>

        <div class="feature-list">
            <div class="feature-item">
                <h4>🎯 Smart Positioning</h4>
                <p>Supports 12 placement options with automatic centering and alignment</p>
            </div>
            <div class="feature-item">
                <h4>🔄 Viewport Flipping</h4>
                <p>Automatically adjusts position when elements would go outside viewport</p>
            </div>
            <div class="feature-item">
                <h4>📏 Custom Offsets</h4>
                <p>Configurable spacing between anchor and positioned elements</p>
            </div>
            <div class="feature-item">
                <h4>📱 Responsive Updates</h4>
                <p>Live repositioning on scroll, resize, and layout changes</p>
            </div>
        </div>

        <div class="test-grid">
            <!-- Basic Positioning Test -->
            <div class="test-card">
                <h3>🧭 Basic Positioning</h3>
                <p>Test the four primary positioning directions with automatic centering.</p>
                
                <div class="control-group">
                    <button id="basic-top" class="btn btn-primary btn-sm">⬆️ Top</button>
                    <button id="basic-bottom" class="btn btn-primary btn-sm">⬇️ Bottom</button>
                    <button id="basic-left" class="btn btn-primary btn-sm">⬅️ Left</button>
                    <button id="basic-right" class="btn btn-primary btn-sm">➡️ Right</button>
                </div>

                <div class="code-example">
<span class="comment">&lt;!-- Basic positioning examples --&gt;</span>
&lt;div <span class="attribute">data-anchor-top</span>=<span class="string">"'#basic-top'"</span>&gt;Top tooltip&lt;/div&gt;
&lt;div <span class="attribute">data-anchor-bottom</span>=<span class="string">"'#basic-bottom'"</span>&gt;Bottom tooltip&lt;/div&gt;
                </div>

                <!-- Basic tooltips -->
                <div data-anchor-top="'#basic-top'" class="tooltip">Top positioned tooltip</div>
                <div data-anchor-bottom="'#basic-bottom'" class="tooltip">Bottom positioned tooltip</div>
                <div data-anchor-left="'#basic-left'" class="tooltip">Left positioned tooltip</div>
                <div data-anchor-right="'#basic-right'" class="tooltip">Right positioned tooltip</div>
            </div>

            <!-- Alignment Variations Test -->
            <div class="test-card">
                <h3>🎚️ Alignment Variations</h3>
                <p>Test start and end alignments for precise positioning control.</p>
                
                <div class="control-group">
                    <button id="align-top-start" class="btn btn-success btn-sm">↖️ Top Start</button>
                    <button id="align-top-end" class="btn btn-success btn-sm">↗️ Top End</button>
                    <button id="align-bottom-start" class="btn btn-success btn-sm">↙️ Bottom Start</button>
                    <button id="align-bottom-end" class="btn btn-success btn-sm">↘️ Bottom End</button>
                </div>

                <div class="code-example">
<span class="comment">&lt;!-- Alignment examples --&gt;</span>
&lt;div <span class="attribute">data-anchor-top-start</span>=<span class="string">"'#align-top-start'"</span>&gt;Top-start&lt;/div&gt;
&lt;div <span class="attribute">data-anchor-bottom-end</span>=<span class="string">"'#align-bottom-end'"</span>&gt;Bottom-end&lt;/div&gt;
                </div>

                <!-- Alignment tooltips -->
                <div data-anchor-top-start="'#align-top-start'" class="tooltip success">Top-start aligned</div>
                <div data-anchor-top-end="'#align-top-end'" class="tooltip success">Top-end aligned</div>
                <div data-anchor-bottom-start="'#align-bottom-start'" class="tooltip success">Bottom-start aligned</div>
                <div data-anchor-bottom-end="'#align-bottom-end'" class="tooltip success">Bottom-end aligned</div>
            </div>

            <!-- Offset Testing -->
            <div class="test-card">
                <h3>📏 Custom Offsets</h3>
                <p>Test different offset values to control spacing between elements.</p>
                
                <div class="control-group">
                    <button id="offset-5" class="btn btn-warning btn-sm">5px Gap</button>
                    <button id="offset-15" class="btn btn-warning btn-sm">15px Gap</button>
                    <button id="offset-30" class="btn btn-warning btn-sm">30px Gap</button>
                    <button id="offset-50" class="btn btn-warning btn-sm">50px Gap</button>
                </div>

                <div class="code-example">
<span class="comment">&lt;!-- Offset examples --&gt;</span>
&lt;div <span class="attribute">data-anchor-bottom-offset-5</span>=<span class="string">"'#offset-5'"</span>&gt;5px offset&lt;/div&gt;
&lt;div <span class="attribute">data-anchor-bottom-offset-30</span>=<span class="string">"'#offset-30'"</span>&gt;30px offset&lt;/div&gt;
                </div>

                <!-- Offset tooltips -->
                <div data-anchor-bottom-offset-5="'#offset-5'" class="tooltip warning">5px offset tooltip</div>
                <div data-anchor-bottom-offset-15="'#offset-15'" class="tooltip warning">15px offset tooltip</div>
                <div data-anchor-bottom-offset-30="'#offset-30'" class="tooltip warning">30px offset tooltip</div>
                <div data-anchor-bottom-offset-50="'#offset-50'" class="tooltip warning">50px offset tooltip</div>
            </div>

            <!-- Rich Content Test -->
            <div class="test-card">
                <h3>🎨 Rich Content Types</h3>
                <p>Test different content types including popovers, notifications, and menus.</p>
                
                <div class="control-group">
                    <button id="rich-popover" class="btn btn-primary">💬 Popover</button>
                    <button id="rich-notification" class="btn btn-danger">🔔 Notification</button>
                    <button id="rich-menu" class="btn btn-success">📋 Menu</button>
                </div>

                <div class="code-example">
<span class="comment">&lt;!-- Rich content examples --&gt;</span>
&lt;div <span class="attribute">data-anchor-bottom</span>=<span class="string">"'#rich-popover'"</span> class="popover"&gt;
  &lt;h4&gt;Popover Title&lt;/h4&gt;
  &lt;p&gt;Rich content here&lt;/p&gt;
&lt;/div&gt;
                </div>

                <!-- Rich content elements -->
                <div data-anchor-bottom="'#rich-popover'" class="popover">
                    <div class="popover-header">🎉 Rich Popover Content</div>
                    <div class="popover-body">This popover demonstrates how the anchor plugin handles more complex content with multiple elements and varied sizes.</div>
                </div>

                <div data-anchor-top="'#rich-notification'" class="tooltip danger">
                    🚨 Important notification message that requires attention!
                </div>

                <div data-anchor-bottom-start="'#rich-menu'" class="dropdown-menu">
                    <div class="dropdown-item">📝 Edit Item</div>
                    <div class="dropdown-item">📋 Copy to Clipboard</div>
                    <div class="dropdown-item">📤 Share</div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">🗑️ Delete</div>
                    <div class="dropdown-item">⚙️ Settings</div>
                </div>
            </div>

            <!-- Edge Cases and Flipping -->
            <div class="test-card">
                <h3>🔄 Viewport Edge Testing</h3>
                <p>Test automatic flipping when elements would extend beyond viewport boundaries.</p>
                
                <div class="edge-container">
                    <button id="edge-tl" class="btn btn-danger btn-sm edge-button top-left">TL</button>
                    <button id="edge-tr" class="btn btn-danger btn-sm edge-button top-right">TR</button>
                    <button id="edge-bl" class="btn btn-danger btn-sm edge-button bottom-left">BL</button>
                    <button id="edge-br" class="btn btn-danger btn-sm edge-button bottom-right">BR</button>
                    <button id="edge-center" class="btn btn-primary edge-button center">Center</button>
                    
                    <div class="edge-info">
                        <strong>Hover corner buttons to test flipping behavior</strong><br>
                        <small>Tooltips should automatically flip to stay in viewport</small>
                    </div>
                </div>

                <div class="code-example">
<span class="comment">&lt;!-- Auto-flipping examples --&gt;</span>
&lt;div <span class="attribute">data-anchor-top</span>=<span class="string">"'#edge-tl'"</span>&gt;Will flip to bottom&lt;/div&gt;
&lt;div <span class="attribute">data-anchor-bottom</span>=<span class="string">"'#edge-bl'"</span>&gt;Will flip to top&lt;/div&gt;
                </div>

                <!-- Edge flipping tooltips -->
                <div data-anchor-top="'#edge-tl'" class="tooltip danger">Should flip to bottom when near top edge</div>
                <div data-anchor-top="'#edge-tr'" class="tooltip danger">Should flip to bottom when near top edge</div>
                <div data-anchor-bottom="'#edge-bl'" class="tooltip danger">Should flip to top when near bottom edge</div>
                <div data-anchor-bottom="'#edge-br'" class="tooltip danger">Should flip to top when near bottom edge</div>
                <div data-anchor-bottom="'#edge-center'" class="tooltip">Center positioned - normal behavior</div>
            </div>

            <!-- Performance and Responsiveness -->
            <div class="test-card">
                <h3>⚡ Performance & Responsiveness</h3>
                <p>Test live repositioning during page interactions and layout changes.</p>
                
                <div class="control-group">
                    <button id="perf-scroll" class="btn btn-success">📜 Scroll Test</button>
                    <button id="perf-resize" class="btn btn-warning">🔄 Resize Test</button>
                    <button id="perf-dynamic" class="btn btn-primary">⚡ Dynamic Test</button>
                </div>

                <div class="code-example">
<span class="comment">&lt;!-- Responsive positioning --&gt;</span>
<span class="comment">&lt;!-- Auto-updates on scroll, resize, and content changes --&gt;</span>
&lt;div <span class="attribute">data-anchor-bottom</span>=<span class="string">"'#perf-scroll'"</span>&gt;Live updating tooltip&lt;/div&gt;
                </div>

                <!-- Performance test tooltips -->
                <div data-anchor-bottom="'#perf-scroll'" class="tooltip success">
                    This tooltip updates position automatically during scroll events
                </div>
                <div data-anchor-left="'#perf-resize'" class="tooltip warning">
                    Repositions on window resize
                </div>
                <div data-anchor-right="'#perf-dynamic'" class="tooltip">
                    Handles dynamic content changes
                </div>
            </div>
        </div>

        <!-- Instructions and Features -->
        <div class="test-card" style="margin-top: 20px;">
            <h3>🧪 Testing Instructions</h3>
            <ol>
                <li><strong>Hover over buttons</strong> to see tooltips and popovers in different positions</li>
                <li><strong>Test edge cases</strong> by hovering corner buttons to see automatic flipping</li>
                <li><strong>Scroll the page</strong> while hovering to verify responsive positioning</li>
                <li><strong>Resize the browser window</strong> to test viewport boundary detection</li>
                <li><strong>Check browser console</strong> for detailed logging and error reporting</li>
                <li><strong>Try different content types</strong> to see how the plugin handles various sizes</li>
            </ol>
            
            <div class="code-example">
<span class="comment">// Key features tested:</span>
- 12 placement positions (top, bottom, left, right + start/end variants)
- Custom offset values (5px to 50px+ supported)
- Automatic viewport boundary detection and flipping
- Live repositioning on scroll, resize, and content changes
- Rich content support (tooltips, popovers, menus, notifications)
- Cross-browser compatibility and performance optimization
            </div>
        </div>
    </div>

    <!-- Load the compiled anchor plugin -->
    <script src="./dist/anchor.js"></script>
    <script>
        console.log('🎯 Datastar Anchor Plugin - Comprehensive Test Suite');
        console.log('Version: 1.0.0 | Features: Smart positioning, viewport flipping, responsive updates');
        
        // Get plugin from global scope
        const AnchorPlugin = window.DatastarAnchorPlugin;
        const statusEl = document.getElementById('status');
        
        if (!AnchorPlugin) {
            console.error('❌ AnchorPlugin not found on window object');
            statusEl.textContent = '❌ Plugin failed to load - Check console for errors';
            statusEl.className = 'status-bar error';
        } else {
            console.log('✅ AnchorPlugin loaded successfully:', AnchorPlugin);
            
            // Initialize plugin functionality
            function initializePlugin() {
                console.log('🔄 Initializing anchor plugin...');
                
                // Find all elements with anchor attributes
                const anchorElements = document.querySelectorAll('[data-anchor], [data-anchor-top], [data-anchor-bottom], [data-anchor-left], [data-anchor-right], [data-anchor-top-start], [data-anchor-top-end], [data-anchor-bottom-start], [data-anchor-bottom-end], [data-anchor-left-start], [data-anchor-left-end], [data-anchor-right-start], [data-anchor-right-end], [data-anchor-bottom-offset-5], [data-anchor-bottom-offset-15], [data-anchor-bottom-offset-30], [data-anchor-bottom-offset-50]');
                
                console.log(`📊 Found ${anchorElements.length} elements with anchor attributes`);
                
                // Apply plugin to each element
                let successCount = 0;
                let errorCount = 0;
                
                anchorElements.forEach((element, index) => {
                    try {
                        // Find the anchor attribute
                        const anchorAttr = Array.from(element.attributes).find(attr => 
                            attr.name.startsWith('data-anchor')
                        );
                        
                        if (anchorAttr) {
                            const key = anchorAttr.name.replace('data-', '');
                            const value = anchorAttr.value;
                            
                            console.log(`📍 [${index + 1}/${anchorElements.length}] Applying ${anchorAttr.name}="${value}"`);
                            AnchorPlugin.apply(element, key, value);
                            successCount++;
                        }
                    } catch (error) {
                        console.error(`❌ Error applying plugin to element ${index + 1}:`, error);
                        errorCount++;
                    }
                });
                
                console.log(`📈 Plugin initialization complete: ${successCount} success, ${errorCount} errors`);
                
                if (errorCount === 0) {
                    statusEl.textContent = `✅ Plugin loaded successfully - ${successCount} anchored elements ready`;
                    statusEl.className = 'status-bar success';
                } else {
                    statusEl.textContent = `⚠️ Plugin loaded with ${errorCount} errors - Check console`;
                    statusEl.className = 'status-bar error';
                }
            }
            
            // Set up hover interactions
            function setupInteractions() {
                console.log('🖱️ Setting up hover interactions...');
                
                const buttons = document.querySelectorAll('.btn');
                let interactionCount = 0;
                
                buttons.forEach(button => {
                    const buttonId = button.id;
                    if (!buttonId) return;
                    
                    // Find associated tooltip/popover
                    const associatedElement = document.querySelector(`[data-anchor*="#${buttonId}"], [data-anchor-top*="#${buttonId}"], [data-anchor-bottom*="#${buttonId}"], [data-anchor-left*="#${buttonId}"], [data-anchor-right*="#${buttonId}"], [data-anchor-top-start*="#${buttonId}"], [data-anchor-top-end*="#${buttonId}"], [data-anchor-bottom-start*="#${buttonId}"], [data-anchor-bottom-end*="#${buttonId}"], [data-anchor-left-start*="#${buttonId}"], [data-anchor-left-end*="#${buttonId}"], [data-anchor-right-start*="#${buttonId}"], [data-anchor-right-end*="#${buttonId}"], [data-anchor-bottom-offset-5*="#${buttonId}"], [data-anchor-bottom-offset-15*="#${buttonId}"], [data-anchor-bottom-offset-30*="#${buttonId}"], [data-anchor-bottom-offset-50*="#${buttonId}"]`);
                    
                    if (associatedElement) {
                        console.log(`🔗 Setting up interaction for #${buttonId}`);
                        
                        button.addEventListener('mouseenter', () => {
                            console.log(`👆 Showing tooltip for #${buttonId}`);
                            associatedElement.style.display = 'block';
                            
                            // Force repositioning for initially hidden elements
                            setTimeout(() => {
                                const anchorAttr = Array.from(associatedElement.attributes).find(attr => 
                                    attr.name.startsWith('data-anchor')
                                );
                                
                                if (anchorAttr) {
                                    const key = anchorAttr.name.replace('data-', '');
                                    const value = anchorAttr.value;
                                    AnchorPlugin.apply(associatedElement, key, value);
                                }
                            }, 10);
                        });
                        
                        button.addEventListener('mouseleave', () => {
                            console.log(`👋 Hiding tooltip for #${buttonId}`);
                            associatedElement.style.display = 'none';
                        });
                        
                        interactionCount++;
                    }
                });
                
                console.log(`✅ Set up ${interactionCount} hover interactions`);
            }
            
            // Performance monitoring
            function setupPerformanceMonitoring() {
                let repositionCount = 0;
                let lastLogTime = Date.now();
                
                // Override the apply method to count repositions
                const originalApply = AnchorPlugin.apply;
                AnchorPlugin.apply = function(...args) {
                    repositionCount++;
                    const now = Date.now();
                    
                    // Log every 5 seconds
                    if (now - lastLogTime > 5000) {
                        console.log(`📊 Performance: ${repositionCount} repositions in last 5 seconds`);
                        repositionCount = 0;
                        lastLogTime = now;
                    }
                    
                    return originalApply.apply(this, args);
                };
                
                console.log('📊 Performance monitoring enabled');
            }
            
            // Add special test behaviors
            function setupSpecialTests() {
                // Dynamic content test
                const dynamicBtn = document.getElementById('perf-dynamic');
                if (dynamicBtn) {
                    let clickCount = 0;
                    dynamicBtn.addEventListener('click', () => {
                        clickCount++;
                        dynamicBtn.textContent = `⚡ Clicked ${clickCount}x`;
                        console.log(`🔄 Dynamic content updated: ${clickCount} clicks`);
                    });
                }
                
                // Scroll position indicator
                let isScrolling = false;
                window.addEventListener('scroll', () => {
                    if (!isScrolling) {
                        console.log('📜 Scroll event detected - repositioning anchored elements');
                        isScrolling = true;
                        setTimeout(() => { isScrolling = false; }, 1000);
                    }
                });
                
                // Resize indicator
                window.addEventListener('resize', () => {
                    console.log('🔄 Window resized - updating anchor positions');
                });
                
                console.log('🧪 Special test behaviors enabled');
            }
            
            // Initialize everything
            function initialize() {
                console.log('🚀 Starting comprehensive test suite initialization...');
                
                try {
                    initializePlugin();
                    setupInteractions();
                    setupPerformanceMonitoring();
                    setupSpecialTests();
                    
                    console.log('🎉 All systems ready! Start testing by hovering over buttons.');
                    console.log('💡 Tip: Open DevTools Console to see detailed logging during interactions.');
                    
                } catch (error) {
                    console.error('💥 Fatal error during initialization:', error);
                    statusEl.textContent = '💥 Initialization failed - Check console for details';
                    statusEl.className = 'status-bar error';
                }
            }
            
            // Start initialization
            initialize();
        }
    </script>
</body>
</html>