<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick Plugin Loading Test</title>
  <style>
    body { font-family: system-ui; padding: 20px; }
    .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    .tooltip { background: #333; color: white; padding: 8px; border-radius: 4px; z-index: 1000; }
  </style>
</head>
<body>
  <h1>üöÄ Quick Plugin Loading Test</h1>
  
  <div id="status"></div>
  
  <h2>Test Buttons</h2>
  <button id="load-btn" onclick="testLoad()">Load Anchor Plugin</button>
  <button id="auto-btn" onclick="testAutoLoad()">Auto-Load Plugins</button>
  <button id="demo-btn" onclick="testDemo()">Test Positioning</button>
  
  <div id="test-anchor">
    <button id="tooltip-btn">Hover for Tooltip</button>
    <div data-anchor-top="'#tooltip-btn'" data-show="$showTooltip" class="tooltip">
      This tooltip should position correctly!
    </div>
  </div>

  <!-- Load dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@starfederation/datastar@1.0.0-beta.1/dist/datastar.js"></script>
  <script src="/dist/plugin-loader-browser.js"></script>

  <script>
    const status = document.getElementById('status');
    
    function log(message, type = 'info') {
      console.log(message);
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.textContent = message;
      status.appendChild(div);
    }

    async function testLoad() {
      try {
        log('Loading anchor plugin...', 'info');
        const plugin = await datastar.loadPlugin('anchor');
        log('‚úÖ Anchor plugin loaded successfully!', 'success');
        console.log('Plugin:', plugin);
      } catch (error) {
        log(`‚ùå Failed to load plugin: ${error.message}`, 'error');
      }
    }

    async function testAutoLoad() {
      try {
        log('Auto-loading plugins...', 'info');
        await datastar.autoLoadPlugins();
        log('‚úÖ Auto-load completed!', 'success');
      } catch (error) {
        log(`‚ùå Auto-load failed: ${error.message}`, 'error');
      }
    }

    function testDemo() {
      if (datastar.signals) {
        datastar.signals.$showTooltip = datastar.signals.$showTooltip || { value: false };
        datastar.signals.$showTooltip.value = !datastar.signals.$showTooltip.value;
        log(`Tooltip ${datastar.signals.$showTooltip.value ? 'shown' : 'hidden'}`, 'info');
      }
    }

    // Wait for Datastar
    document.addEventListener('DOMContentLoaded', () => {
      const checkDatastar = setInterval(() => {
        if (window.datastar) {
          clearInterval(checkDatastar);
          log('‚úÖ Datastar ready', 'success');
          
          if (window.DatastarPluginLoader) {
            log('‚úÖ Plugin Loader ready', 'success');
          } else {
            log('‚ùå Plugin Loader not found', 'error');
          }
        }
      }, 100);
      
      setTimeout(() => {
        clearInterval(checkDatastar);
        if (!window.datastar) {
          log('‚ùå Datastar not found after 5 seconds', 'error');
        }
      }, 5000);
    });
  </script>
</body>
</html>